webpackJsonp([7],{Hdsn:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("gs4M"),i=a.n(r),o=a("FXHS"),s=a.n(o),n={name:"pageAdvert",components:{Editor:a("zL8o").a},data:function(){return{rules:{location:[{required:!0,message:"请选择广告位置",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],imageUrl:[{required:!0,message:"请上传图片",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],isUsed:[{required:!0,message:"请选择是否开启",trigger:"change"}],url:[{required:!0,message:"请输入外链接",trigger:"blur"}]},isouturl:!0,imageUrl:"",isAdd:!0,loading:!1,total:100,Form:{id:"",location:"",title:"",imageUrl:"",url:"",content:"",isUsed:"",createrId:this.$userLogin.getLoginInfo().userNo,existLocationId:"",isOutUrl:1,autoUrl:"",currentPage:1,pageSize:this.$config.PAGE_SIZE},dialogFormVisible:!1,tableData:[],formadvert:{title:"",isUsed:""}}},methods:{handleCurrentChange:function(t){this.getAdvert()},changIsUrl:function(t){this.$data.Form.isOutUrl=t,this.$data.Form.url=""},resetForm:function(){this.$refs.Form.resetFields(),this.$refs.upload.clearFiles(),this.$data.dialogFormVisible=!1},onSubmit:function(){var t=this;return s()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.$data.Form.currentPage=1,t.getAdvert();case 2:case"end":return e.stop()}},e,t)}))()},onAdvertAdd:function(){var t=this;this.$data.isAdd=!0,this.$data.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.Form.resetFields(),t.$refs.upload.clearFiles()})},handleAvatarSuccess:function(t,e){this.$data.Form.imageUrl=e.response.body.url},beforeAvatarUpload:function(t){var e="image/jpeg"===t.type||"image/png",a=t.size/1024/1024<5;return e||this.$message.error("上传头像图片格式不正确!"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),e&&a},editorContent:function(t){this.$data.Form.content=t},handleSee:function(t){window.open(t.url)},handleEdit:function(t,e){var a=this;e&&(this.$data.isAdd=!1,this.$data.dialogFormVisible=!0,this.$nextTick(s()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.$refs.Form.resetFields(),t.next=3,a.$http.post("/advert/advertList",{id:e});case 3:(r=t.sent).success&&(a.$data.Form=r.body,a.$data.Form.currentPage=1,a.$data.Form.pageSize=a.$config.PAGE_SIZE);case 5:case"end":return t.stop()}},t,a)}))))},submitForm:function(){var t=this;return s()(i.a.mark(function e(){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.$data.loading=!0,a=t.$data.isAdd?"/advert/advertAdd":"/advert/advertUpdate",!t.$data.Form.existLocationId){e.next=6;break}return e.next=5,t.$http.post("/advert/advertUpdateLocation",{location:t.$data.Form.existLocationId,isUsed:2});case 5:e.sent;case 6:return"2"==t.$data.Form.isOutUrl&&(t.$data.Form.autoUrl=window.location.origin+"/#/index/advertDetail?noaction=true&id="),t.$data.Form.id=t.$data.isAdd?"":t.$data.Form.id,e.next=10,t.$http.post(a,t.$data.Form);case 10:e.sent.success&&(t.$data.dialogFormVisible=!1,t.$data.Form.isOutUrl=1,t.$notify.success({title:"提示",message:t.$data.isAdd?"添加成功":"修改成功"}),t.getAdvert()),t.$data.loading=!1;case 13:case"end":return e.stop()}},e,t)}))()},submitData:function(){var t,e=this;this.$refs.Form.validate((t=s()(i.a.mark(function t(a){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=5;break}return t.next=3,e.$http.get("/advert/existLocation",{location:e.$data.Form.location});case 3:(r=t.sent).success&&r.body?e.$confirm("该位置已经占用，是否覆盖？").then(function(){e.$data.Form.existLocationId=r.body.location,e.submitForm()}).catch(function(){}):e.submitForm();case 5:case"end":return t.stop()}},t,e)})),function(e){return t.apply(this,arguments)}))},getAdvert:function(){var t=this;return s()(i.a.mark(function e(){var a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t.$data.Form),a={currentPage:t.$data.Form.currentPage,pageSize:t.$data.Form.pageSize,title:t.$data.formadvert.title,isUsed:t.$data.formadvert.isUsed},e.next=4,t.$http.post("/advert/advertList",a);case 4:(r=e.sent).success&&(t.$data.total=r.body.count,t.$data.tableData=r.body.rows);case 6:case"end":return e.stop()}},e,t)}))()},handleDelete:function(t,e){var a=this;this.$confirm("确定删除此条数据吗？").then(s()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.$http.post("/advert/advertDelete",{id:e});case 2:(r=t.sent).success&&r.body&&(a.$notify({title:"提示",message:"删除成功！",type:"success"}),a.getAdvert());case 4:case"end":return t.stop()}},t,a)}))).catch(function(){a.$message({type:"info",message:"已取消删除"})})}},mounted:function(){this.getAdvert()}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"page-advert"}},[a("div",{staticClass:"element-breadcrumb"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[t._v("首页")]),t._v(" "),a("el-breadcrumb-item",{attrs:{to:{path:"/advert"}}},[t._v("广告管理")]),t._v(" "),a("el-breadcrumb-item",[t._v("广告列表")])],1)],1),t._v(" "),a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.formadvert}},[a("el-form-item",{attrs:{label:"搜索标题"}},[a("el-input",{attrs:{size:"mini",placeholder:""},model:{value:t.formadvert.title,callback:function(e){t.$set(t.formadvert,"title",e)},expression:"formadvert.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"选择状态"}},[a("el-select",{attrs:{size:"mini",placeholder:""},model:{value:t.formadvert.isUsed,callback:function(e){t.$set(t.formadvert,"isUsed",e)},expression:"formadvert.isUsed"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),t._l(this.$Tool.getEnumData("IsUsedEnum"),function(t){return a("el-option",{key:t.val,attrs:{label:t.text,value:t.value}})})],2)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSubmit}},[t._v("搜索")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"mini"},on:{click:t.onAdvertAdd}},[t._v("新增")])],1)],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"",height:this.$Tool.getTableHeight()}},[a("el-table-column",{attrs:{prop:"location",label:"位置",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{"margin-left":"10px"}},[t._v("位置"+t._s(e.row.location))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"title",label:"标题",width:"300"}}),t._v(" "),a("el-table-column",{attrs:{prop:"url",label:"链接"}}),t._v(" "),a("el-table-column",{attrs:{prop:"isUsed",label:"状态",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(1==e.row.isUsed?"启用":"禁止"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"id",label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.isUsed?a("div",[a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){t.handleSee(e,e.row.id)}}},[t._v("查看\n          ")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){t.handleEdit(e,e.row.id)}}},[t._v("编辑\n          ")])],1):a("div",[a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){t.handleSee(e.row,e.row.id)}}},[t._v("查看\n          ")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){t.handleDelete(e.$index,e.row.id)}}},[t._v("删除\n          ")])],1)]}}])})],1),t._v(" "),a("div",{staticClass:"block "},[a("el-pagination",{staticClass:"right",attrs:{background:"","current-page":t.Form.currentPage,"page-size":t.Form.pageSize,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.$set(t.Form,"currentPage",e)}}})],1),t._v(" "),a("el-dialog",{attrs:{title:t.isAdd?"广告页添加":"广告页修改",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"Form",staticClass:"demo-ruleForm",attrs:{size:"medium",model:t.Form,"label-width":"80px",rules:t.rules}},[a("el-form-item",{attrs:{label:"位置",prop:"location"}},[a("el-select",{attrs:{size:"medium",placeholder:"请选择位置"},model:{value:t.Form.location,callback:function(e){t.$set(t.Form,"location",e)},expression:"Form.location"}},[a("el-option",{attrs:{label:"1",value:"1"}}),t._v(" "),a("el-option",{attrs:{label:"2",value:"2"}}),t._v(" "),a("el-option",{attrs:{label:"3",value:"2"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-input",{attrs:{size:"medium",placeholder:"请输入标题"},model:{value:t.Form.title,callback:function(e){t.$set(t.Form,"title",e)},expression:"Form.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"上传图片",prop:"imageUrl"}},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:this.$config.HTTPOPENAPIURL+"/openapi/common/file/upload",headers:{appId:this.$config.HTTPHEADER_APPID,version:this.$config.HTTPHEADER_APPVERSION,sign:this.$config.HTTPHEADER_APPSIGN},data:{message:"{}"},name:"files","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload}},[t.Form.imageUrl?a("img",{staticClass:"avatar",attrs:{src:t.Form.imageUrl}}):a("i",{staticClass:"el-icon-plus  avatar-uploader-icon"})])],1),t._v(" "),1==t.Form.isOutUrl||""==t.Form.isOutUrl?a("el-form-item",{attrs:{label:"外链URL",prop:"url"}},[a("el-input",{staticStyle:{width:"85%"},attrs:{size:"medium",placeholder:"请输入URL"},model:{value:t.Form.url,callback:function(e){t.$set(t.Form,"url",e)},expression:"Form.url"}}),t._v(" "),a("el-button",{staticStyle:{width:"14%"},attrs:{type:"primary"},on:{click:function(e){t.changIsUrl(2)}}},[t._v(" 不使用")])],1):t._e(),t._v(" "),2==t.Form.isOutUrl?a("el-form-item",{attrs:{label:"外链URL",prop:""}},[a("el-input",{staticStyle:{width:"85%"},attrs:{size:"medium",disabled:2==t.Form.isOutUrl,placeholder:"请输入URL"}}),t._v(" "),a("el-button",{staticStyle:{width:"14%"},attrs:{type:"primary"},on:{click:function(e){t.changIsUrl(1)}}},[t._v("使用")])],1):t._e(),t._v(" "),2==t.Form.isOutUrl?a("el-form-item",{attrs:{label:"内容",prop:"content"}},[t.isAdd?a("editor",{on:{change:t.editorContent}}):a("editor",{attrs:{"editor-content":t.Form.content},on:{change:t.editorContent}})],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"是否启用",prop:"isUsed"}},[a("el-radio-group",{model:{value:t.Form.isUsed,callback:function(e){t.$set(t.Form,"isUsed",e)},expression:"Form.isUsed"}},t._l(this.$Tool.getEnumData("IsUsedEnum"),function(e){return a("el-radio",{key:e.value,attrs:{name:"type",label:e.value,value:e.value}},[t._v("\n            "+t._s(e.text)+"\n          ")])}))],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"medium"},on:{click:function(e){t.resetForm("Form")}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitData("Form")}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var d=a("jadU")(n,l,!1,function(t){a("cq7w")},"data-v-079768c5",null);e.default=d.exports},cq7w:function(t,e){}});
//# sourceMappingURL=7.123e17c2943a60944fd9.js.map